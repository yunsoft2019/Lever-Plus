# 1 束搜索
# 参数说明: task dataset gpu_ids sampler [beam_model]
# beam_model 可选值: flamingo_3B (默认) 或 qwen2.5_vl_3B

# 使用 Flamingo-3B 模型
# 随机采样器（RandSampler）
bash scripts/generate_data.sh vqa okvqa_local "[0]" rand_sampler flamingo_3B
# 文本相似度采样器（TextSimSampler）
bash scripts/generate_data.sh vqa okvqa_local "[0]" text_sim_sampler flamingo_3B
# 图片相似度采样器（ImgSimSampler）
bash scripts/generate_data.sh vqa okvqa_local "[0]" img_sim_sampler flamingo_3B
# 混合采样器（MixSampler）
bash scripts/generate_data.sh vqa okvqa_local "[0]" mix_sampler flamingo_3B

# 使用 Qwen2.5-VL-3B-Instruct 模型
# 随机采样器（RandSampler）
bash scripts/generate_data.sh vqa okvqa_local "[0]" rand_sampler qwen2.5_vl_3B
# 文本相似度采样器（TextSimSampler）
bash scripts/generate_data.sh vqa okvqa_local "[0]" text_sim_sampler qwen2.5_vl_3B
# 图片相似度采样器（ImgSimSampler）
bash scripts/generate_data.sh vqa okvqa_local "[0]" img_sim_sampler qwen2.5_vl_3B
# 混合采样器（MixSampler）
bash scripts/generate_data.sh vqa okvqa_local "[0]" mix_sampler qwen2.5_vl_3B

# 2 训练
```
# 随机采样器
bash scripts/train_lever_lm.sh vqa okvqa_local 1 query_img_text_icd_img_text rand_sampler
# 文本相似度采样器
bash scripts/train_lever_lm.sh vqa okvqa_local 1 query_img_text_icd_img_text text_sim_sampler
# 图片相似度采样器
bash scripts/train_lever_lm.sh vqa okvqa_local 1 query_img_text_icd_img_text img_sim_sampler
# 混合采样器
bash scripts/train_lever_lm.sh vqa okvqa_local 1 query_img_text_icd_img_text mix_sampler
```

# 3 从检查点继续训练
```
# 根据参数自动加载对应的检查点并继续训练
# 参数: task dataset device_num lever_lm sampler
# 随机采样器（RandSampler）
bash scripts/train_from_checkpoints.sh vqa okvqa_local 1 query_img_text_icd_img_text rand_sampler
# 文本相似度采样器（TextSimSampler）
bash scripts/train_from_checkpoints.sh vqa okvqa_local 1 query_img_text_icd_img_text text_sim_sampler
# 图片相似度采样器（ImgSimSampler）
bash scripts/train_from_checkpoints.sh vqa okvqa_local 1 query_img_text_icd_img_text img_sim_sampler
# 混合采样器（MixSampler）
bash scripts/train_from_checkpoints.sh vqa okvqa_local 1 query_img_text_icd_img_text mix_sampler
```

# 4 推理
```
# 根据不同的采样器训练的模型参数进行推理
# 参数: task dataset device lever_lm sampler [inference_bs]
# 随机采样器（RandSampler）
bash scripts/inference.sh vqa okvqa_local 0 query_img_text_icd_img_text rand_sampler
# 文本相似度采样器（TextSimSampler）
bash scripts/inference.sh vqa okvqa_local 0 query_img_text_icd_img_text text_sim_sampler
# 图片相似度采样器（ImgSimSampler）
bash scripts/inference.sh vqa okvqa_local 0 query_img_text_icd_img_text img_sim_sampler
# 混合采样器（MixSampler）
bash scripts/inference.sh vqa okvqa_local 0 query_img_text_icd_img_text mix_sampler
```

# 5 检查GPU支持
```
python -c "import torch; print('GPU可用:', torch.cuda.is_available())"
```