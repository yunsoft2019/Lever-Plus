# 实验结果诊断报告

## 问题描述

除了 KL_BETA=0.15（冻结版本）的结果不同（56.1%），其他所有配置的结果几乎完全相同（55.85%），包括：
- KL_BETA=0.12, 0.145, 0.155, 0.18（冻结版本）
- KL_BETA=0.15（解冻版本，Epoch 3）
- KL_BETA=0.1, LR=1e-5（解冻版本，Epoch 3）
- KL_BETA=0.1, LR=2e-5（解冻版本，Epoch 1）

## 诊断结果

### 1. Checkpoint 参数确实不同

| 对比 | 平均参数差异 | 最大参数差异 | 状态 |
|------|-------------|-------------|------|
| kl012_frozen vs kl015_unfrozen | 0.000288 | 0.000338 | ⚠️ 差异较小 |
| kl012_frozen vs kl010_unfrozen_lr1e5 | 0.000473 | 0.000656 | ⚠️ 差异较小 |
| kl012_frozen vs kl010_unfrozen_lr2e5 | 0.000450 | 0.000529 | ⚠️ 差异较小 |

**结论**：Checkpoint 确实不同，但参数差异很小（< 0.001）。

### 2. 所有实验都从同一个 RCE checkpoint 开始

- **RCE checkpoint**: `kl012/rce_epoch5.pt`
- **所有实验**都从这个 checkpoint 开始训练 GRPO

**结论**：起点相同，GRPO 训练后的差异可能很小。

### 3. 0.15 冻结版本的 checkpoint 不存在

- **预期路径**: `v3_RandSampler_Qwen2_5-VL-3B-Instruct_kl015/grpo_epoch1.pt`
- **实际状态**: ❌ 不存在
- **存在的目录**: 
  - `kl0155`（KL_BETA=0.155）
  - `kl015_unfrozen`（KL_BETA=0.15，解冻版本）

**结论**：**0.15 冻结版本的 checkpoint 不存在！结果（56.1%）可能来自其他目录或不同的实验。**

## 为什么结果几乎完全相同？

### 原因 1: 参数差异太小

- **参数差异**: 0.0002-0.0006（平均）
- **影响**: 这些差异可能不足以改变模型的输出分布
- **模型敏感性**: 模型对这样小的参数变化不敏感

### 原因 2: 起点相同

- **RCE checkpoint**: 所有实验都从 `kl012/rce_epoch5.pt` 开始
- **GRPO 训练**: 虽然使用了不同的 KL_BETA 和学习率，但训练后的差异很小
- **可能原因**: 
  - 学习率太小（5e-6, 1e-5, 2e-5）
  - 训练 epochs 太少（1-3）
  - KL_BETA 约束太强

### 原因 3: 0.15 冻结版本使用了不同的配置

- **Checkpoint 不存在**: 无法确认其实际配置
- **可能使用了**:
  - 不同的 RCE checkpoint
  - 更多的训练 epochs
  - 不同的数据文件
  - 不同的训练配置

## 建议

### 1. 找到 0.15 冻结版本的 checkpoint

```bash
# 查找所有可能的 0.15 冻结版本 checkpoint
find results/okvqa/model_cpk -name "*kl015*" -type f | grep -E "(grpo|rce)" | head -10
```

### 2. 对比 0.15 冻结版本的参数

```bash
# 如果找到了，对比其参数
python3 scripts/diagnose_checkpoint_issue.py
```

### 3. 尝试更大的参数差异

- **更大的学习率**: 5e-5 或 1e-4（而不是 5e-6, 1e-5, 2e-5）
- **更多的 epochs**: 5-10（而不是 1-3）
- **更小的 KL_BETA**: 0.05 或 0.08（而不是 0.1, 0.12, 0.15）

### 4. 检查训练日志

- 确认训练时是否真的使用了不同的 KL_BETA 和学习率
- 确认训练过程是否正常
- 确认参数是否真的被更新

## 结论

1. ✅ **Checkpoint 确实不同**，但参数差异很小（< 0.001）
2. ✅ **所有实验都从同一个 RCE checkpoint 开始**
3. ❌ **0.15 冻结版本的 checkpoint 不存在**，无法确认其配置
4. ⚠️  **参数差异太小，不足以影响推理结果**

**建议**：找到 0.15 冻结版本的 checkpoint，对比其参数，找出为什么它不同。

