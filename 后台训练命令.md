# V3 后台训练命令

## 方法1：使用 nohup（推荐，即使关闭终端也继续运行）

```bash
# 1. RandSampler (GPU 0)
nohup bash scripts/train_v3.sh vqa okvqa_local 0 query_img_text_icd_img_text rand_sampler qwen2.5_vl_3B > logs/train_rand.log 2>&1 &

# 2. TextSimSampler (GPU 1)
nohup bash scripts/train_v3.sh vqa okvqa_local 1 query_img_text_icd_img_text text_sim_sampler qwen2.5_vl_3B > logs/train_text.log 2>&1 &

# 3. ImgSimSampler (GPU 2)
nohup bash scripts/train_v3.sh vqa okvqa_local 2 query_img_text_icd_img_text img_sim_sampler qwen2.5_vl_3B > logs/train_img.log 2>&1 &

# 4. MixSampler (GPU 3)
nohup bash scripts/train_v3.sh vqa okvqa_local 3 query_img_text_icd_img_text mix_sampler qwen2.5_vl_3B > logs/train_mix.log 2>&1 &
```

## 方法2：直接后台运行（简单，但关闭终端会停止）

```bash
# 1. RandSampler (GPU 0)
bash scripts/train_v3.sh vqa okvqa_local 0 query_img_text_icd_img_text rand_sampler qwen2.5_vl_3B > logs/train_rand.log 2>&1 &

# 2. TextSimSampler (GPU 1)
bash scripts/train_v3.sh vqa okvqa_local 1 query_img_text_icd_img_text text_sim_sampler qwen2.5_vl_3B > logs/train_text.log 2>&1 &

# 3. ImgSimSampler (GPU 2)
bash scripts/train_v3.sh vqa okvqa_local 2 query_img_text_icd_img_text img_sim_sampler qwen2.5_vl_3B > logs/train_img.log 2>&1 &

# 4. MixSampler (GPU 3)
bash scripts/train_v3.sh vqa okvqa_local 3 query_img_text_icd_img_text mix_sampler qwen2.5_vl_3B > logs/train_mix.log 2>&1 &
```

## 说明

- `> logs/train_rand.log`：将标准输出重定向到日志文件
- `2>&1`：将标准错误也重定向到同一个日志文件
- `&`：在后台运行
- `nohup`：即使关闭终端也继续运行（推荐）

## 查看日志

```bash
# 查看实时日志
tail -f logs/train_rand.log
tail -f logs/train_text.log
tail -f logs/train_img.log
tail -f logs/train_mix.log

# 查看所有日志（实时）
tail -f logs/train_*.log

# 查看最后100行
tail -n 100 logs/train_rand.log
```

## 查看进程

```bash
# 查看所有训练进程
ps aux | grep train_v3.sh | grep -v grep

# 查看GPU使用情况
nvidia-smi
watch -n 1 nvidia-smi  # 实时监控
```

## 停止任务

```bash
# 停止所有训练任务
pkill -f train_v3.sh

# 停止特定GPU的任务（例如GPU 0）
pkill -f "train_v3.sh.*okvqa_local 0"
```

