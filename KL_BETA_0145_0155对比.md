# KL_BETA 对比分析（0.145 vs 0.15 vs 0.155）

## 训练配置

所有模型使用相同的配置：
- **数据文件**: `rl_data_k64_v3.json`（统一数据）
- **RCE checkpoint**: `kl012/rce_epoch5.pt`（相同起点）
- **GRPO epochs**: 3
- **GRPO LR**: 5e-6
- **Batch size**: 1
- **冻结 backbone**: 是（只训练 50.1% 参数）

---

## 训练指标对比

### Epoch 1 训练指标

| KL_BETA | KL值 | Train Loss | PPO Loss | Adv Std | Adv Max | 备注 |
|---------|------|------------|----------|---------|---------|------|
| **0.12** | 0.08082 | 0.01620 | 0.00650 | - | - | 参考 |
| **0.145** | **0.08471** | 0.01989 | 0.00761 | 0.1703 | 0.1966 | ✅ KL值最高 |
| **0.15** | ? | ? | ? | - | - | 参考文档未提供详细指标 |
| **0.155** | 0.08164 | **0.01438** | **0.00172** | 0.1703 | 0.1966 | ✅ Train Loss最低，PPO Loss最低 |
| **0.18** | 0.08134 | 0.02038 | 0.00574 | - | - | 参考 |

**观察**：
- 0.145 的 KL 值最高（0.08471），说明策略更新幅度最大
- 0.155 的 Train Loss 最低（0.01438），说明训练更稳定
- 0.155 的 PPO Loss 最低（0.00172），说明策略更新更保守

### Epoch 2 训练指标

| KL_BETA | KL值 | Train Loss | PPO Loss | Adv Std | Adv Max | 备注 |
|---------|------|------------|----------|---------|---------|------|
| **0.12** | 0.07178 | 0.01721 | 0.00860 | - | - | 参考 |
| **0.145** | 0.07384 | 0.02235 | 0.01164 | 0.2328 | 0.3558 | |
| **0.15** | ? | ? | ? | - | - | 参考文档未提供详细指标 |
| **0.155** | 0.07144 | 0.02249 | 0.01142 | 0.2328 | 0.3558 | |
| **0.18** | 0.07002 | 0.02235 | 0.01164 | - | - | 参考 |

**观察**：
- 所有 KL 值都收敛到 0.07 左右，差异很小（< 4%）
- Train Loss 都在 0.017-0.022 之间

### Epoch 3 训练指标

| KL_BETA | KL值 | Train Loss | PPO Loss | Adv Std | Adv Max | 备注 |
|---------|------|------------|----------|---------|---------|------|
| **0.145** | 0.07138 | **0.02030** | **0.00995** | 0.2328 | 0.3558 | ✅ Train Loss最低，PPO Loss最低 |
| **0.155** | **0.06901** | 0.02135 | 0.01065 | 0.2328 | 0.3558 | ✅ KL值最低 |

**观察**：
- 0.155 的 KL 值最低（0.06901），说明策略更保守
- 两个值的差异很小（约 3%）

---

## 推理结果对比（待评估）

### Epoch 1 推理结果（200样本）

| KL_BETA | Shot 1 | Shot 2 | Shot 3 | Shot 4 | 平均 | vs 0.15 |
|---------|--------|--------|--------|--------|------|---------|
| **0.12** | 57.0% | 56.1% | 55.1% | 55.2% | 55.85% | -0.25% ⬇️ |
| **0.145** | **57.0%** | **56.1%** | **55.1%** | **55.2%** | **55.85%** | -0.25% ⬇️ |
| **0.15** | **58.8%** | **56.6%** | 53.9% | 55.2% | **56.1%** | 基准 ✅ |
| **0.155** | **57.0%** | **56.1%** | **55.1%** | **55.2%** | **55.85%** | -0.25% ⬇️ |
| **0.18** | 57.0% | 56.1% | 55.1% | 55.2% | 55.85% | -0.25% ⬇️ |

**⚠️ 重要发现**：
- **0.12、0.145、0.155、0.18 的结果完全相同**（都是 57.0%, 56.1%, 55.1%, 55.2%）
- 只有 **0.15 的结果不同**（58.8%, 56.6%, 53.9%, 55.2%），且表现最好

**评估结果**：
- ✅ KL_BETA=0.145 Epoch 1: **57.0%, 56.1%, 55.1%, 55.2%** (平均 55.85%)
- ✅ KL_BETA=0.155 Epoch 1: **57.0%, 56.1%, 55.1%, 55.2%** (平均 55.85%)

**⚠️ 重要发现**：0.145 和 0.155 的结果完全相同，且与 0.12、0.18 的结果也完全相同！

### Epoch 2 推理结果（200样本）

| KL_BETA | Shot 1 | Shot 2 | Shot 3 | Shot 4 | 平均 | vs 0.15 |
|---------|--------|--------|--------|--------|------|---------|
| **0.12** | 57.0% | 56.1% | 55.1% | 55.2% | 55.85% | -0.25% ⬇️ |
| **0.145** | ? | ? | ? | ? | ? | ? |
| **0.15** | ? | ? | ? | ? | ? | ? |
| **0.155** | ? | ? | ? | ? | ? | ? |
| **0.18** | 57.0% | 56.1% | 55.1% | 55.2% | 55.85% | -0.25% ⬇️ |

**待评估**：
- [ ] KL_BETA=0.145 Epoch 2
- [ ] KL_BETA=0.155 Epoch 2
- [ ] KL_BETA=0.15 Epoch 2（参考）

### Epoch 3 推理结果（200样本）

| KL_BETA | Shot 1 | Shot 2 | Shot 3 | Shot 4 | 平均 | vs 0.15 |
|---------|--------|--------|--------|--------|------|---------|
| **0.145** | ? | ? | ? | ? | ? | ? |
| **0.155** | ? | ? | ? | ? | ? | ? |

**待评估**：
- [ ] KL_BETA=0.145 Epoch 3
- [ ] KL_BETA=0.155 Epoch 3

---

## 评估命令

### KL_BETA=0.145

```bash
# Epoch 1
bash scripts/eval_grpo_kl0145.sh 1 0 200

# Epoch 2
bash scripts/eval_grpo_kl0145.sh 2 0 200

# Epoch 3
bash scripts/eval_grpo_kl0145.sh 3 0 200
```

### KL_BETA=0.155

```bash
# Epoch 1
bash scripts/eval_grpo_kl0155.sh 1 0 200

# Epoch 2
bash scripts/eval_grpo_kl0155.sh 2 0 200

# Epoch 3
bash scripts/eval_grpo_kl0155.sh 3 0 200
```

---

## 初步分析

### 训练指标分析

1. **KL 值趋势**：
   - Epoch 1: 0.145 (0.08471) > 0.155 (0.08164) > 0.12 (0.08082) ≈ 0.18 (0.08134)
   - Epoch 2: 所有值收敛到 0.07 左右，差异很小
   - Epoch 3: 0.155 (0.06901) < 0.145 (0.07138)

2. **Train Loss**：
   - Epoch 1: 0.155 (0.01438) < 0.12 (0.01620) < 0.145 (0.01989) < 0.18 (0.02038)
   - 0.155 的训练损失最低，说明训练更稳定

3. **PPO Loss**：
   - Epoch 1: 0.155 (0.00172) < 0.18 (0.00574) < 0.12 (0.00650) < 0.145 (0.00761)
   - 0.155 的 PPO Loss 最低，说明策略更新更保守

### 预期

基于训练指标：
- **0.145**: KL 值较高，策略更新幅度大，可能性能更好或更差（取决于数据）
- **0.155**: KL 值较低，策略更保守，训练更稳定，可能性能更稳定
- **0.15**: 目前最好的（56.1%），需要评估 0.145 和 0.155 看是否能超越

---

## 下一步

1. ✅ **已完成**: 训练 KL_BETA=0.145 和 0.155
2. ⏳ **待完成**: 评估所有 epochs 的推理结果
3. ⏳ **待完成**: 对比分析，找出最佳 KL_BETA 值

