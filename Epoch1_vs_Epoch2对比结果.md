# Epoch 1 vs Epoch 2 对比结果

> 日期：2025-12-23  
> 对比：50 epochs 训练后的两个最优 checkpoint

---

## 一、测试配置

- **数据集**: OKVQA
- **测试数据量**: 100 samples
- **推理模型**: Qwen2.5-VL-3B-Instruct
- **采样器**: RandSampler
- **训练配置**: 50 epochs GRPO 训练，方案五（关闭 Rank Normalization）

---

## 二、Checkpoint 信息

| Checkpoint | Val Loss | PPO Loss | KL | Adv Std | 选择原因 |
|------------|----------|----------|----|---------|---------|
| **Epoch 1** | 5.13576 | 0.00007 | 0.06802 | 0.0063 | Val Loss 最小 |
| **Epoch 2** | 5.14132 | -0.00007 | 0.04286 | 0.0062 | Val Loss 第二小 |

---

## 三、推理结果对比（100 samples）

### 3.1 完整对比表

| Shot | Epoch 1 | Epoch 2 | 差异 | 评价 |
|------|---------|---------|------|------|
| **1** | 64.8% | **64.8%** | **0.0%** | ➡️ 完全持平 |
| **2** | 63.8% | **64.8%** | **+1.0%** | ⬆️ **明显提升** ⭐ |
| **3** | 63.2% | 62.2% | **-1.0%** | ⬇️ 明显下降 |
| **4** | 61.8% | **61.8%** | **0.0%** | ➡️ 完全持平 |

### 3.2 统计汇总

| 指标 | 值 |
|------|-----|
| **平均差异** | **0.0%** |
| **最大提升** | +1.0% (Shot 2) |
| **最大下降** | -1.0% (Shot 3) |
| **提升的配置数** | 1/4 (25%) |
| **下降的配置数** | 1/4 (25%) |
| **持平的配置数** | 2/4 (50%) |

---

## 四、详细分析

### 4.1 关键发现

**Epoch 2 的优势**：
- ✅ **Shot 2 提升明显**（+1.0%），这是主要应用场景
- ✅ Shot 1 和 Shot 4 持平

**Epoch 2 的劣势**：
- ⚠️ Shot 3 下降明显（-1.0%）

### 4.2 与 Baseline 对比

| Shot | Baseline | Epoch 1 | Epoch 2 | Epoch 1 vs Baseline | Epoch 2 vs Baseline |
|------|----------|---------|---------|---------------------|---------------------|
| **1** | 64.2% | 64.8% | **64.8%** | +0.6% | **+0.6%** |
| **2** | 64.8% | 63.8% | **64.8%** | -1.0% | **0.0%** ⭐ |
| **3** | 62.8% | 63.2% | 62.2% | +0.4% | -0.6% |
| **4** | 61.4% | 61.8% | **61.8%** | +0.4% | **+0.4%** |
| **平均** | 63.3% | 63.4% | **63.4%** | +0.1% | **+0.1%** |

**结论**：
- ✅ **Epoch 2 在 Shot 2 场景达到 Baseline 水平**（64.8%），这是重要突破
- ✅ Epoch 2 平均正确率与 Epoch 1 相同（63.4%）
- ⚠️ Epoch 2 在 Shot 3 场景略低于 Baseline（-0.6%）

### 4.3 与方案五之前（grpo_epoch3）对比

| Shot | 方案五之前 | Epoch 1 | Epoch 2 | Epoch 1 vs 之前 | Epoch 2 vs 之前 |
|------|-----------|---------|---------|----------------|----------------|
| **1** | 63.8% | 64.8% | **64.8%** | +1.0% | **+1.0%** |
| **2** | **65.8%** | 63.8% | **64.8%** | -2.0% | **-1.0%** ⬆️ |
| **3** | 62.2% | 63.2% | 62.2% | +1.0% | 0.0% |
| **4** | 61.8% | 61.8% | **61.8%** | 0.0% | **0.0%** |
| **平均** | 63.4% | 63.4% | **63.4%** | 0.0% | **0.0%** |

**结论**：
- ✅ **Epoch 2 在 Shot 2 场景比 Epoch 1 更接近方案五之前**（-1.0% vs -2.0%）
- ✅ Epoch 2 在 Shot 1 场景与 Epoch 1 相同（+1.0% vs 方案五之前）

---

## 五、结论

### 5.1 Epoch 2 的优势

1. **Shot 2 场景表现更好**：
   - Epoch 2: 64.8%（与 Baseline 持平）
   - Epoch 1: 63.8%（低于 Baseline 1.0%）
   - **Epoch 2 在主要应用场景上表现更好**

2. **整体表现稳定**：
   - 平均正确率与 Epoch 1 相同（63.4%）
   - Shot 1 和 Shot 4 表现稳定

### 5.2 推荐使用 Epoch 2

**理由**：
- ✅ Shot 2 是主要应用场景，Epoch 2 在此场景表现更好
- ✅ Epoch 2 在 Shot 2 场景达到 Baseline 水平（64.8%）
- ✅ 平均正确率与 Epoch 1 相同，但 Shot 2 提升明显

**权衡**：
- ⚠️ Shot 3 场景略低于 Epoch 1（-1.0%），但如果主要关注 Shot 2，这个权衡是值得的

---

## 六、最终推荐

### 推荐使用：Epoch 2

**Checkpoint**: `grpo_epoch2_v2format.ckpt`

**原因**：
1. ✅ Shot 2 场景表现最好（64.8%，与 Baseline 持平）
2. ✅ 平均正确率与 Epoch 1 相同（63.4%）
3. ✅ 在主要应用场景（Shot 2）上比 Epoch 1 提升 1.0%

**使用命令**：
```bash
export LEVER_LM_CHECKPOINT_PATH=./results/okvqa/model_cpk/v3_RandSampler_Qwen2_5-VL-3B-Instruct/grpo_epoch2_v2format.ckpt
bash scripts/inference.sh vqa okvqa_local 5 query_img_text_icd_img_text rand_sampler qwen2.5_vl_3B v3
```

---

## 七、总结

### 50 Epochs 训练的最优 Checkpoint

经过对比，**Epoch 2 是最优选择**：
- ✅ Shot 2 场景：64.8%（与 Baseline 持平，比 Epoch 1 高 1.0%）
- ✅ 平均正确率：63.4%（与 Epoch 1 相同）
- ✅ 在主要应用场景上表现最佳

**建议**：
- 使用 Epoch 2 作为最终模型
- 如果主要关注 Shot 2 场景，Epoch 2 是最佳选择

---

*报告生成时间：2025-12-23*


